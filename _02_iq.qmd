---
title-meta: iq
execute:
  warning: false
  echo: false
  message: false
format:
  typst:
    keep-typ: true
  pdf:
    keep-md: true
    keep-tex: true
  html: 
    toc: true
params:
  pheno: iq
---

<!-- ## General Cognitive Ability -->

{{< include _02_iq_text.qmd >}}

```{r}
#| label: data-iq
data <- bwu::read_data(pheno = "iq")
```

```{r}
#| label: filter-iq
domains <- c("Intelligence/General Ability")
scales <- c(
  "Cognitive Efficiency",
  "Cognitive Proficiency (CPI)",
  "Cognitive Proficiency Index",
  "Cognitive Proficiency",
  "Crystallized Knowledge Index",
  "Crystallized Knowledge",
  "Fluid Reasoning (FRI)",
  "Fluid Reasoning Index",
  "Fluid Reasoning",
  "Full Scale (FSIQ)",
  "General Ability (GAI)",
  "General Ability Index",
  "General Ability",
  "General Intelligence",
  "NAB Attention Index",
  "NAB Executive Functions Index",
  "NAB Language Index",
  "NAB Memory Index",
  "NAB Spatial Index",
  "NAB Total Index",
  "Nonverbal (NVI)",
  "Perceptual Reasoning (PRI)",
  "Processing Speed (PSI)",
  "Processing Speed Index",
  "Processing Speed",
  "RBANS Total Index",
  "Test of Premorbid Functioning",
  "TOPF Standard Score",
  "Verbal Comprehension (VCI)",
  "Visual Spatial (VSI)",
  "Vocabulary Acquisition (VAI)",
  "Word Reading",
  "Working Memory (WMI)",
  "Working Memory Index",
  "Working Memory"
)
data <- bwu::filter_domain_scale(data, domain = domains, scale = scales)
```

```{r}
#| label: text-iq
#| cache: true
bwu::flatten_scale_text(data, file = "_02_iq_raw.qmd")
```

```{r}
#| label: qtbl-iq
#| dev: tikz
#| fig-process: pdf2png
options(tikzDefaultEngine = "xetex")
source_note <- "*Note:* Index scores have a mean of 100 and a standard deviation of 15."
table_name <- "table_iq"
pheno <- "iq"
bwu::make_tbl_gt(data, pheno = pheno, source_note = source_note, table_name = table_name)
```


```{=typst}
#let domain = "General Cognitive Ability"
<qtbl-iq>
#figure([#image("table_iq.png", width: 50%)],
  caption: [
    #domain Test Scores
  ],
  kind: "qtbl",
  supplement: [Table],
)
```

```{r}
#| label: fig-iq
#| out-width: 70%
#| fig-cap: "*General Ability* is the overall skill to reason, solve problems, and gain useful knowledge. *Crystallized Knowledge* involves understanding the world through language and reasoning. *Fluid Reasoning* is the logical analysis and solution of new problems, identifying underlying patterns, and applying logic."

roma <- c( '#7E1700', '#832504', '#883008', '#8E3B0B', '#92450F', '#984E14', '#9C5717', '#A05F1B', '#A4671E', '#A86F22', '#AD7826', '#B0802B', '#B58A30', '#B99336', '#BD9C3D', '#C2A647', '#C7B051', '#CBBA5D', '#CEC56C', '#D0CE7A', '#D2D78A', '#D1DE98', '#CFE4A6', '#CBE7B3', '#C4EABD', '#BCEAC6', '#B2E8CD', '#A7E6D2', '#9BE2D4', '#8EDDD7', '#80D6D7', '#73CED5', '#65C6D5', '#59BDD2', '#4FB5D0', '#45ABCB', '#3DA3C8', '#379BC5', '#3292C2', '#2E8ABF', '#2A81BA', '#2779B7', '#2471B4', '#2269B0', '#1F60AD', '#1B57A8', '#184EA4', '#1344A0', '#0C3B9C', '#023198' )

pheno <- "iq"
iq <- dplyr::filter(
  data,
  scale %in% c("General Ability", "Crystallized Knowledge", "Fluid Reasoning")
)
bwu::make_fig(
  data = iq,
  pheno = pheno,
  x = iq$z_mean_narrow,
  y = iq$narrow,
  colors = roma
)
```
