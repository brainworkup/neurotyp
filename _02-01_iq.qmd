## General Cognitive Ability {#sec-iq}

{{< include _02-01_iq_text.qmd >}}

```{r}
#| label: setup-iq
#| include: false
# domain
domains <- c("General Cognitive Ability")
# phenotype
pheno <- "iq"
```

```{r}
#| label: export-iq
#| include: false
#| eval: false
iq <- readr::read_csv("neurocog.csv") |>
  dplyr::filter(domain == domains) |>
  dplyr::filter(!is.na(z_mean_domain)) |>
  dplyr::select(
    scale, score, z, percentile, range, test_name, domain, subdomain, narrow,
    pass, verbal, timed, result, z_mean_domain, z_sd_domain, z_mean_subdomain,
    z_sd_subdomain, z_mean_narrow, z_sd_narrow, z_mean_pass, z_sd_pass,
    z_mean_verbal, z_sd_verbal, z_mean_timed, z_sd_timed
  )
readr::write_csv(iq, paste0(pheno, ".csv"))
```

```{r}
#| label: data-iq
#| include: false
#| eval: false

# data
data <- bwu::read_data(pheno = pheno)
# filter by scale
scales <- c(
  "Full Scale (FSIQ)",
  "General Ability (GAI)",
  "General Ability Index",
  "General Ability",
  "General Intelligence",
  "NAB Total Index",
  "Test of Premorbid Functioning",
  "TOPF Standard Score",
  "Word Reading",
  "Crystallized Knowledge Index",
  "Crystallized Knowledge",
  "Verbal Comprehension (VCI)",
  "Verbal Comprehension",
  "Vocabulary Acquisition (VAI)",
  "Fluid Reasoning (FRI)",
  "Fluid Reasoning Index",
  "Fluid Reasoning",
  "Perceptual Reasoning",
  "Perceptual Reasoning (PRI)",
  "Nonverbal (NVI)",
  "Visual Spatial (VSI)",
  "Working Memory (WMI)",
  "Working Memory Index",
  "Working Memory",
  "Auditory Working Memory (AWMI)",
  "Processing Speed (PSI)",
  "Processing Speed Index",
  "Processing Speed",
  "Cognitive Proficiency (CPI)",
  "Cognitive Proficiency Index",
  "Cognitive Proficiency",
  "NAB Attention Index",
  "NAB Language Index",
  "NAB Memory Index",
  "NAB Spatial Index",
  "NAB Executive Functions Index",
  "RBANS Total Index",
  # from g
  "Global Neurocognitive Index (G)",
  "General Ability",
  "Crystallized Knowledge",
  "Fluid Reasoning",
  "Verbal/Language",
  "Verbal Fluency",
  "Visual Perception/Construction",
  "Attention/Executive",
  "Attention",
  "Attention Span",
  "Attentional Fluency",
  "Executive Function",
  "Planning",
  "Processing Speed",
  "Psychomotor Speed",
  "Cognitive Efficiency",
  "Working Memory",
  "Memory",
  "Learning Efficiency",
  "Delayed Recall",
  "Academic Skills",
  "Reading",
  "Writing",
  "Math",
  "Academic Fluency"
)
# Filter data
data_iq <- bwu::filter_data(data, domain = domains, scale = scales)
```

```{r}
#| label: text-iq
#| cache: true
#| include: false

bwu::cat_neuropsych_results(data = data_iq, file = "_02-01_iq_text.qmd")
```

```{r}
#| label: qtbl-iq
#| dev: tikz
#| fig-process: pdf2png
#| include: false
#| eval: true
options(tikzDefaltEngine = "xetex")

include <- c(
  "Cognitive Proficiency",
  # "Crystallized Knowledge",
  # "Fluid Reasoning",
  "General Ability (GAI)",
  "General Ability",
  "Perceptual Reasoning (PRI)",
  "Perceptual Reasoning",
  # "Processing Speed (PSI)",
  # "Processing Speed",
  "Verbal Comprehension (VCI)",
  "Verbal Comprehension"
  # "Working Memory (WMI)",
  # "Working Memory",
  # "Processing Speed",
  # "Working Memory"
)
# data_iq <- dplyr::filter(data_iq, scale %in% include)
data_iq <- readr::read_csv("iq.csv")
# footnotes
source_note <- gt::md("Standard Score: Mean = 100 [50th‰], SD ± 15 [16th‰, 84th‰]")
pheno <- "iq"
table_name <- "table_iq"
grp_iq <- list(
  standard_score = c(
    "Composite Scores", "Test of Premorbid Functioning", "WAIS-IV", "WAIS-4", "WASI-2", "WISC-5", "WRAT-5", "KTEA-3", "NAB", "RBANS"
  )
)
vertical_padding <- 0
multiline <- TRUE

bwu::tbl_gt(
  data = data_iq,
  pheno = pheno,
  table_name = table_name,
  source_note = source_note,
  grp_standard_score = grp_iq[["standard_score"]],
  dynamic_grp = grp_iq,
  vertical_padding = vertical_padding,
  multiline = multiline
)
```

```{r}
#| label: fig-iq
#| include: false
#| fig-cap: "_Premorbid Ability_ is an estimate of an individual's intellectual functioning prior to known or suspected onset of brain disease or dysfunction. _General Ability_ is the overall skill to reason, solve problems, and gain useful knowledge. _Crystallized Knowledge_ involves understanding the world through language and reasoning. _Fluid Reasoning_ is the logical analysis and solution of new problems, identifying underlying patterns, and applying logic."

x <- data_iq$z_mean_subdomain
y <- data_iq$subdomain
colors <- NULL
# return_plot <- TRUE
return_plot <- Sys.getenv("RETURN_PLOT")
filename <- "fig_iq.svg"

# Make dotplot
bwu::dotplot(
  data = data_iq,
  x = x,
  y = y,
  colors = colors,
  return_plot = return_plot,
  filename = filename
)
```

```{=typst}
#let domain(title: none, file_qtbl, file_fig) = {
  let font = (font: "Fira Sans", size: 9pt)
  set text(..font)
    grid(
      columns: (50%, 50%),
      gutter: 8pt,
        figure([#image(file_qtbl)],
          caption: figure.caption(position: top, [#title]),
          kind: "qtbl",
          supplement: [Table],
          ),
        figure([#image(file_fig, width: auto)],
          caption: figure.caption(position: bottom, [
            _General Ability_ refers to an overall capacity to reason, to solve problems, and to learn useful information. _Crystallized Knowledge_ involves understanding the world through language and reasoning. _Fluid Reasoning_ is the logical analysis and solution of new problems, identifying underlying patterns, and applying logic.
          ]),
          placement: none,
          kind: "image",
          supplement: [Fig.],
          gap: 0.5em,
          ),
      )
  }
```

```{=typst}
#let title = "General Cognitive Ability"
#let file_qtbl = "table_iq.png"
#let file_fig = "fig_iq.svg"
#domain(
  title: [#title Index Scores],
  file_qtbl,
  file_fig,
  )
```
