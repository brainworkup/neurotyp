---
title-meta: spatial
execute:
  warning: false
  echo: false
  message: false
format:
  typst:
    keep-typ: true
  pdf:
    keep-md: true
    keep-tex: true
  html: 
    toc: true
---

<!-- ## Visual Perception/Construction -->

{{< include _05_spatial_text.qmd >}}

```{r}
#| label: data-spatial
data <- bwu::read_data(pheno = "spatial")
```

```{r}
#| label: filter-spatial
filter_file <- c(
  "Arrows",
  "Bicycle Drawing",
  "Block Design No Time Bonus",
  "Block Design Partial Score",
  "Block Design",
  "Clock Drawing",
  "Clocks",
  "Design Construction",
  "Design Copying General",
  "Design Copying Motor",
  "Design Copying Process",
  "Design Copying",
  "Figure Copy",
  "Figure Drawing Copy",
  "Figure Weights",
  "Geometric Puzzles",
  "Line Orientation",
  "Map Reading",
  "Matrix Reasoning",
  "NAB Spatial Index",
  "Object Assembly",
  "Picture Concepts",
  "ROCF Copy",
  "ROCFT Copy",
  "Spatial Domain",
  "Visual Discrimination",
  "Visual Puzzles",
  "Visuospatial/Constructional Index"
)
data <- bwu::filter_domain(data, domain = "Visual Perception/Construction", filter_file = filter_file)
```

```{r}
#| label: text-spatial
#| cache: true
bwu::flatten_scale_text(data, file = "_02_spatial_raw.qmd")
```

```{r}
#| label: qtbl-spatial
#| fig-align: center
#| dev: tikz
#| fig-process: pdf2png
#| cache: false
options(tikzDefaultEngine = "xetex")

index_score <- "*Note:* T-scores (Mean = 50, SD = 10), Scaled scores (Mean = 10,
SD = 3)."
table_name <- "table_spatial"
pheno <- "spatial"
bwu::make_tbl_gt(data, pheno = pheno, index_score = index_score, table_name = table_name)
```


```{=typst}
#let domain = "Visual Perception/Construction"
<qtbl-spatial>
#figure([#image("table_spatial.png", width: 50%)],
  caption: [
    #domain Test Scores
  ],
  kind: "qtbl",
  supplement: [Table],
)
```

```{r}
#| label: fig-spatial
#| out-width: 70%
#| fig-cap: "Visual Perception/Construction"

# load packages
xfun::pkg_attach2(c(
  "gt",
  "dplyr",
  "glue",
  "webshot2",
  "ggplot2",
  "ggthemes",
  "scales",
  "bwu"
))
roma <- c(
  "#7E1700", "#893107", "#934610", "#9C5717", "#A5681F", "#AD7A27",
  "#B58B31", "#BF9F40", "#C7B354", "#CFC970", "#D2DA90", "#CDE5AC",
  "#C0E9C2", "#ACE7D0", "#93DFD5", "#77D1D7", "#5DC0D2", "#47AECD",
  "#389CC6", "#2F8CBF", "#277AB8", "#2169B0", "#1C58A9", "#1345A0",
  "#023198"
)
pheno <- "spatial"
data_dotplot <- dplyr::filter(
  data,
  scale %in% filter_plot
)
fig_spatial <- bwu::make_fig(
  data = data_dotplot,
  x = data_dotplot$z_mean_narrow,
  y = data_dotplot$narrow,
  pheno = pheno,
  colors = roma
)
fig_spatial
```
