---
title-meta: spatial
execute:
  warning: false
  echo: false
  message: false
format:
  typst:
    keep-typ: true
  pdf:
    keep-md: true
    keep-tex: true
  html: 
    toc: true
params:
  pheno: spatial
---

<!-- ## Visual Perception/Construction -->

{{< include _05_spatial_text.qmd >}}

```{r}
#| label: data-spatial

data <- bwu::read_data(pheno = "spatial")
```

```{r}
#| label: filter-spatial

domains <- "Visual Perception/Construction"
scales <- c(
  "Arrows",
  "Bicycle Drawing",
  "Block Design No Time Bonus",
  "Block Design Partial Score",
  "Block Design",
  "Clock Drawing",
  "Clocks",
  "Design Construction",
  "Design Copying General",
  "Design Copying Motor",
  "Design Copying Process",
  "Design Copying",
  "Figure Copy",
  "Figure Drawing Copy",
  "Figure Weights",
  "Geometric Puzzles",
  "Line Orientation",
  "Map Reading",
  "Matrix Reasoning",
  "NAB Spatial Index",
  "Object Assembly",
  "Picture Concepts",
  "ROCF Copy",
  "ROCFT Copy",
  "Spatial Domain",
  "Visual Discrimination",
  "Visual Puzzles",
  "Visuospatial/Constructional Index"
)
data <- bwu::filter_domain_scale(data, domain = domains, scale = scales)
```

```{r}
#| label: text-spatial
#| cache: true

bwu::flatten_scale_text(data, file = "_05_spatial_raw.qmd")
```

```{r}
#| label: qtbl-spatial
#| dev: tikz
#| fig-process: pdf2png

options(tikzDefaultEngine = "xetex")
source_note <- gt::md("*Note:* T-scores (Mean = 50, SD = 10), Scaled scores (Mean =
10, SD = 3).")

table_name <- "table_spatial"
pheno <- "spatial"

bwu::make_tbl_gt(data,
    pheno = pheno, 
    source_note = source_note, 
    table_name = table_name
)
```

```{r}
#| label: fig-spatial
#| out-width: 70%
#| eval: true
#| fig-cap: "Visuoperception, visuoconstruction, and visuospatial processing refer to abilities such as mentally visualizing how objects should look from different angles, visualizing how to put objects together so that they fit correctly, and being able to accurately and efficiently copy and/or reproduce visual-spatial information onto paper."

pheno <- "spatial"
spatial <- dplyr::filter(data, !is.na(percentile))

bwu::make_fig(
    data = spatial,
    pheno = pheno,
    x = spatial$z_mean_narrow,
    y = spatial$narrow,
    colors = NULL
)
```

```{=typst}
#let domain(title: none, file_qtbl, file_fig) = {
  let font = (font: "Inria Serif", size: 9pt)
  set text(..font)
  grid(
  columns: (40%, 60%),
  gutter: 8pt,
figure([#image(file_qtbl)],
  caption: [
    #title
  ],
  caption-pos: top,
  kind: "qtbl",
  supplement: [*Table*],
),
figure(
  placement: bottom,
  caption: [
    Visuoperception, visuoconstruction, and visuospatial processing refer to abilities such as mentally visualizing how objects should look from different angles, visualizing how to put objects together so that they fit correctly, and being able to accurately and efficiently copy and/or reproduce visual-spatial information onto paper.
  ],
  kind: "image",
  supplement: [
    *Figure*
    ],
  gap: 1em,
  [
    #image(file_fig)
    ],
),
)
}
```

```{=typst}
#let file_qtbl = "table_spatial.png"
#let file_fig = "_05_spatial_files/figure-typst/fig-spatial-1.svg"
#domain(
  title: "Visual Perception/Construction Test Scores",
  file_qtbl,
  file_fig
)
```
