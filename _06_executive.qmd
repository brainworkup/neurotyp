---
title-meta: executive
execute:
  warning: false
  echo: false
  message: false
format:
  typst:
    keep-typ: true
  pdf:
    keep-md: true
    keep-tex: true
  html: 
    toc: true
params:
  pheno: executive
---

<!-- ## Attention/Executive -->

{{< include _06_executive_text.qmd >}}

```{r}
#| label: setup
xfun::pkg_attach2(c(
  "gt",
  "dplyr",
  "glue",
  "webshot2",
  "ggplot2",
  "ggthemes",
  "scales",
  "bwu"
))
```
```{r}
#| label: data-executive
data <- bwu::read_data(pheno = "executive")
```

```{r}
#| label: filter-executive
scales <- c(
  "Animal Coding",
  "Arithmetic",
  "Attention Domain",
  "Attention Index",
  "Auditory Working Memory (AWMI)",
  "Bug Search",
  "Cancellation Random",
  "Cancellation Structured",
  "Cancellation",
  "Categories",
  "Category Fluency",
  "Clock Drawing",
  "Coding",
  "Comprehension",
  "CVLT-3 Total Intrusions",
  "CVLT-3 Total Repetitions",
  "D-KEFS Color Naming",
  "D-KEFS Inhibition Total Errors",
  "D-KEFS Inhibition",
  "D-KEFS Switching Total Errors",
  "D-KEFS Switching",
  "D-KEFS Word Reading",
  "Digit Span Backward",
  "Digit Span Forward",
  "Digit Span Sequencing",
  "Digit Span",
  "Digits Backward Longest Span",
  "Digits Backward",
  "Digits Forward Longest Span",
  "Digits Forward",
  "Dots",
  "Driving Scenes",
  "Executive Functions Domain",
  "Judgment",
  "Letter Fluency",
  "Letter-Number Sequencing",
  "Longest Digit Span Backward",
  "Longest Digit Span Forward",
  "Longest Digit Span Sequence",
  "Longest Letter-Number Sequence",
  "Matrix Reasoning",
  "Mazes",
  "NAB Attention Index",
  "NAB Executive Functions Index",
  "Numbers & Letters Part A Efficiency",
  "Numbers & Letters Part A Errors",
  "Numbers & Letters Part A Speed",
  "Numbers & Letters Part B Efficiency",
  "Numbers & Letters Part C Efficiency",
  "Numbers & Letters Part D Disruption",
  "Numbers & Letters Part D Efficiency",
  "Orientation",
  "Picture Memory",
  "Picture Span",
  "Processing Speed (PSI)",
  "ROCFT Copy",
  "Similarities",
  "Spatial Addition",
  "Spatial Span",
  "Symbol Search",
  "Symbol Span",
  "TMT, Part A",
  "TMT, Part B",
  "Total Deviation Score",
  "Trails A",
  "Trails B",
  "Unstructured Task",
  "Word Generation Perseverations",
  "Word Generation",
  "Working Memory (WMI)",
  "Zoo Locations"
)
data <- bwu::filter_domain_scale(data, domain = "Attention/Executive", scale = scales)
```

```{r}
#| label: text-executive
#| cache: true
bwu::flatten_scale_text(data, file = "_06_executive_raw.qmd")
```

```{r}
#| label: qtbl-executive
#| dev: tikz
#| fig-process: pdf2png
options(tikzDefaultEngine = "xetex")
source_note <- gt::md("*Note:* T-scores (Mean = 50, SD = 10), Scaled scores (Mean = 10, SD = 3).")
table_name <- "table_executive"
pheno <- "executive"
# more filtering for exe tables
data <- dplyr::filter(data, test_name != "CVLT-3 Brief")
data <- dplyr::filter(data, scale != "Orientation")
data <- dplyr::filter(data, scale %in% c(
  "NAB Attention Index",
  "Digits Forward",
  "Digits Forward Longest Span",
  "Digits Backward",
  "Digits Backward Longest Span",
  "Dots",
  "Numbers & Letters Part A Efficiency",
  "Numbers & Letters Part B Efficiency",
  "Numbers & Letters Part C Efficiency",
  "Numbers & Letters Part D Efficiency",
  "Driving Scenes",
  "NAB Executive Functions Index",
  "Mazes",
  "Categories",
  "Word Generation",
  "Word Generation Perseverations",
  "Judgment",
  "Working Memory (WMI)",
  "Arithmetic",
  "Digit Span",
  "Longest Digit Span Forward",
  "Longest Digit Span Backward",
  "Longest Digit Span Sequence",
  "Letter-Number Sequencing",
  "Symbol Span",
  "Spatial Span",
  "Picture Span",
  "Processing Speed (PSI)",
  "Coding",
  "Cancellation",
  "Symbol Search",
  "TMT, Part A",
  "TMT, Part B",
  "Unstructured Task",
  "Attention Index"
))
bwu::make_tbl_gt(data, pheno = pheno, source_note = source_note, table_name = table_name)
```


```{=typst}
#let domain = "Attention/Executive"
<qtbl-executive>
#figure([#image("table_executive.png", width: 50%)],
  caption: [
    #domain Test Scores
  ],
  kind: "qtbl",
  supplement: [Table],
)
```

```{r}
#| label: fig-executive
#| out-width: 70%
#| fig-cap: "Attention and executive functions underlie most, if not all, domains of cognitive performance. These are behaviors and skills that allow individuals to successfully carry-out instrumental and social activities, academic work, engage with others effectively, problem solve, and successfully interact with the environment to get needs met."
#| fig-subcap: "Attention/Executive Subdomain Plots"
roma <- c(
  "#7E1700", "#893107", "#934610", "#9C5717", "#A5681F", "#AD7A27",
  "#B58B31", "#BF9F40", "#C7B354", "#CFC970", "#D2DA90", "#CDE5AC",
  "#C0E9C2", "#ACE7D0", "#93DFD5", "#77D1D7", "#5DC0D2", "#47AECD",
  "#389CC6", "#2F8CBF", "#277AB8", "#2169B0", "#1C58A9", "#1345A0",
  "#023198"
)
pheno <- "executive"
data_dotplot <- dplyr::filter(data, !is.na(percentile))
bwu::make_fig(
  data = data_dotplot,
  pheno = pheno,
  x = data_dotplot$z_mean_subdomain,
  y = data_dotplot$subdomain,
  colors = roma
)
```
