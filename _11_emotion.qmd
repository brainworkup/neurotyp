---
title-meta: emotion
execute:
  warning: false
  echo: false
  message: false
format:
  typst:
    keep-typ: true
  pdf:
    keep-md: true
    keep-tex: true
params:
  pheno: "emotion"
---

<!-- ## Emotional/Behavioral/Personality -->

{{< include _11_emotion_text.qmd >}}

```{r}
#| label: data-emotion
pheno <- "emotion"
data <- bwu::read_data(pheno = pheno)
```

```{r}
#| label: filter-emotion
domains <- c(
  "Psychiatric Disorders", "Personality Disorders", "Substance Use",
  "Psychosocial Problems"
)
scales <- c(
  "Activity Level",
  "Affective (A)",
  "Affective (D)",
  "Affective Instability",
  "Aggression",
  "Aggressive Attitude",
  "ALC Estimated Score",
  "Alcohol Problems",
  "Antisocial Behaviors",
  "Antisocial Features",
  "Anxiety-Related Disorders",
  "Anxiety",
  "BAI-2 Total Score",
  "BID-2 Total Score",
  "Borderline Features",
  "Cognitive (A)",
  "Cognitive (D)",
  "Conversion",
  "Depression",
  "Dominance",
  "DRG Estimated Score",
  "Drug Problems",
  "Egocentricity",
  "Grandiosity",
  "Health Concerns",
  "Hypervigilance",
  "Identity Problems",
  "Irritability",
  "Mania",
  "Negative Relationships",
  "Nonsupport",
  "Obsessive-Compulsive",
  "Paranoia",
  "Persecution",
  "Phobias",
  "Physical Aggression",
  "Physiological (A)",
  "Physiological (D)",
  "Psychotic Experiences",
  "Resentment",
  "Schizophrenia",
  "Self-Harm",
  "Social Detachment",
  "Somatic Complaints",
  "Somatization",
  "Stimulus-Seeking",
  "Stress",
  "Suicidal Ideation",
  "Thought Disorder",
  "Traumatic Stress",
  "Treatment Rejection",
  "Verbal Aggression",
  "Warmth"
  # ADD BASC3 SRP
)

filter_domain_scale <- function(data, domain, scale) {
  data <- data |>
    dplyr::filter(domain %in% domains, !is.na(percentile)) |>
    dplyr::filter(scale %in% scales)
  return(data)
}

data_emotion <- bwu::filter_domain_scale(data, domain = domains, scale = scales)
```

```{r}
#| label: text-emotion
#| cache: true

bwu::flatten_scale_text(data = data_emotion, file = "_11_emotion_raw.qmd")
```

```{r}
#| label: qtbl-emotion
#| dev: tikz
#| fig-process: pdf2png
#| fig-height: 7
#| eval: false

options(tikzDefaultEngine = "xetex")
source_note <- gt::md("*Note:* T-scores have a mean of 50 and a standard deviation of 10.")
table_name <- "table_emotion"
pheno <- "emotion"
data_emotion <-
  dplyr::filter(data_emotion, domain %in% c(
    "Psychiatric Disorders",
    "Personality Disorders", "Substance Use"
  )) |>
  dplyr::arrange(test_name) |>
  dplyr::arrange(subdomain)

data_emotion <- data_emotion[, c(11, 2, 4, 5, 6)]
colnames(data_emotion)[1] <- "test_name"

bwu::make_tbl_gt(data_emotion, pheno = pheno, source_note = source_note, table_name = table_name)
```

```{r}
#| eval: false

tbl1 <-
  dplyr::filter(data_emotion, domain == "Psychiatric Disorders") |>
  dplyr::arrange(test_name) |>
  dplyr::arrange(subdomain)
tbl1 <- tbl1[, c(11, 2, 4, 5, 6)]
colnames(tbl1)[1] <- "test_name"
table_psych <- bwu::tbl_gt(
  tbl1,
  table_name = "table_psych",
  source_note = source_note
)
tbl2 <-
  dplyr::filter(data_emotion, domain == "Personality Disorders") |>
  dplyr::arrange(test_name) |>
  dplyr::arrange(subdomain)
tbl2 <- tbl2[, c(11, 2, 4, 5, 6)]
colnames(tbl2)[1] <- "test_name"
table_personality <- bwu::tbl_gt(
  tbl2,
  table_name = "table_personality",
  source_note = source_note
)
tbl3 <-
  dplyr::filter(data_emotion, domain == "Substance Use") |>
  dplyr::arrange(test_name) |>
  dplyr::arrange(subdomain)
tbl3 <- tbl3[, c(11, 2, 4, 5, 6)]
colnames(tbl3)[1] <- "test_name"
table_sud <- bwu::tbl_gt(
  tbl3,
  table_name = "table_sud",
  source_note = source_note
)
tbl4 <-
  dplyr::filter(data_emotion, domain == "Psychosocial Problems") |>
  dplyr::arrange(test_name) |>
  dplyr::arrange(subdomain)
tbl4 <- tbl4[, c(11, 2, 4, 5, 6)]
colnames(tbl4)[1] <- "test_name"
table_social <- bwu::tbl_gt(
  tbl4,
  table_name = "table_social",
  source_note = source_note
)
```

```{r}
#| label: fig-emotion
#| out-width: 70%
#| fig-cap: "Mood/Self-Report"

pheno <- "emotion"
emotion <-
  dplyr::filter(data, !is.na(percentile)) |>
  dplyr::filter(domain %in% c("Psychiatric Disorders", "Personality Disorders", "Substance Use"))
bwu::make_dotplot_typ(
  data = emotion,
  pheno = pheno,
  x = emotion$z_mean_subdomain,
  y = emotion$subdomain,
  colors = NULL
)
```

```{=typst}
#let domain(title: none, file_qtbl, file_fig) = {
  let font = (font: "Fira Sans", size: 9pt)
  set text(..font)
  grid(
  columns: (50%, 50%),
  gutter: 8pt,
figure([#image(file_qtbl)],
  caption: [
    #title
  ],
  caption-pos: top,
  kind: "qtbl",
  supplement: [*Table*],
),
figure(
  placement: bottom,
  caption: [
    Mood/Self-Report ... Subdomain Plots
  ],
  kind: "image",
  supplement: [
    *Figure*
    ],
  gap: 1em,
  [
   #image(file_fig)
   ],
),
)
}
```

```{=typst}
#title = "Emotional/Behavioral/Personality"
#let file_qtbl = "table_emotion.png"
#let file_fig = "_11_emotion_files/figure-typst/fig-emotion-1.svg"
#domain(
  title: [#title Self-Report],
  file_qtbl,
  file_fig
)
```
